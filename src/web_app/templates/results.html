<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analysis Results ‚Ä¢ Resume Analyzer</title>
  <link href="{{ url_for('static', filename='css/tw-build.css') }}" rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>body{font-family:'Inter',sans-serif;}</style>
</head>
<body class="min-h-screen bg-gradient-to-br from-sky-50 via-white to-slate-50 dark:from-slate-900 dark:via-slate-950 dark:to-slate-900 text-slate-800 dark:text-slate-100 transition-base">
  <div class="max-w-6xl mx-auto px-5 md:px-8 py-10">
    
    <!-- Navigation -->
    <div class="flex justify-between items-center mb-6 fade-in">
      <a href="/" class="inline-flex items-center text-sm text-slate-600 hover:text-sky-500 dark:text-slate-400 dark:hover:text-sky-400 transition-colors">
        <span class="mr-1">‚Üê</span> New Analysis
      </a>
      <a href="/history" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-slate-700 hover:text-sky-600 dark:text-slate-300 dark:hover:text-sky-400 bg-white hover:bg-slate-50 dark:bg-slate-800 dark:hover:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-700 transition-colors">
        <span class="mr-2">üìã</span>
        View History
      </a>
    </div>

    <!-- Header -->
    <div class="flex items-center justify-between mb-10 fade-in">
      <div>
        <h1 class="text-3xl md:text-4xl font-bold tracking-tight bg-gradient-to-r from-sky-500 to-cyan-400 bg-clip-text text-transparent">Analysis Report</h1>
        <p class="mt-2 text-sm md:text-base text-slate-600 dark:text-slate-400 max-w-xl">
          {% if results.is_quality_mode %}
          Resume quality analysis with extracted skills and improvement suggestions.
          {% else %}
          Semantic relevance, quality signals & keyword coverage extracted from the uploaded resume.
          {% endif %}
        </p>
      </div>
      <div class="flex gap-3">
        <button id="viewToggle" class="btn-outline-tw text-xs md:text-sm flex items-center gap-2">
          <svg id="viewToggleIcon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          <span id="viewToggleText">Simple View</span>
        </button>
        <button id="themeToggle" class="btn-outline-tw text-xs md:text-sm">Toggle Theme</button>
        <a href="{{ url_for('index') }}" class="btn-primary-tw text-xs md:text-sm">New Analysis</a>
      </div>
    </div>

    {% if results %}
      <!-- Quality Check Mode Banner -->
      {% if results.is_quality_mode %}
      <div class="card-tw mb-8 bg-sky-50 dark:bg-sky-900/20 border-2 border-sky-200 dark:border-sky-800 fade-in">
        <div class="flex items-start gap-4">
          <div class="flex-shrink-0 w-12 h-12 rounded-full bg-sky-100 dark:bg-sky-900/40 flex items-center justify-center text-2xl">
            ‚úÖ
          </div>
          <div class="flex-1">
            <h3 class="text-lg font-bold text-sky-700 dark:text-sky-300 mb-1">Quality Check Mode</h3>
            <p class="text-sm text-slate-600 dark:text-slate-400 mb-3">
              Your resume has been analyzed for quality metrics only. Job matching was skipped since no job description was provided.
            </p>
            <a href="{{ url_for('index') }}" class="inline-flex items-center gap-2 text-sm font-medium text-sky-600 dark:text-sky-400 hover:text-sky-700 dark:hover:text-sky-300 transition-colors">
              <span>Add Job Description for Full Analysis</span>
              <span>‚Üí</span>
            </a>
          </div>
        </div>
      </div>
      {% endif %}
      
      {% set sim_pct = results.similarity_score.replace('%','') %}
      {% set qual_pct = results.quality_score.replace('/100','') %}
      
      <!-- SIMPLIFIED VIEW (Hidden by default, shown when toggle is clicked) -->
      <div id="simpleView" class="hidden">
        {% if results.has_enhanced_data and results.enhanced_analysis and results.enhanced_analysis.overall_score is not none %}
          {% set overall_score = results.enhanced_analysis.overall_score %}
          {% set score_color = 'text-green-600 dark:text-green-400' if overall_score >= 75 else ('text-yellow-600 dark:text-yellow-400' if overall_score >= 50 else 'text-red-600 dark:text-red-400') %}
          
          <!-- Overall Score Card -->
          <section class="mb-8">
            <div class="card-tw fade-in flex flex-col items-center justify-center text-center relative overflow-hidden">
              <h2 class="font-semibold text-sm uppercase tracking-wide text-slate-500 dark:text-slate-400 mb-4">Overall Resume Score</h2>
              <div class="metric-ring mb-4" style="--pct: {{ overall_score }}%">
                <span>{{ "%.0f"|format(overall_score) }}%</span>
              </div>
              <p class="text-sm font-semibold mb-2 {{ score_color }}">
                {% if overall_score >= 75 %}üéâ Excellent Performance
                {% elif overall_score >= 50 %}üëç Strong Foundation
                {% else %}üí™ Room for Improvement{% endif %}
              </p>
              <p class="text-xs text-slate-500 dark:text-slate-400 max-w-md">
                {% if overall_score >= 75 %}
                  Your resume demonstrates exceptional quality and strong alignment. Focus on minor refinements to achieve perfection.
                {% elif overall_score >= 50 %}
                  Your resume shows solid promise with good fundamentals. Targeted improvements will strengthen your candidacy.
                {% else %}
                  Your resume needs focused attention. The recommendations below will help you improve critical areas.
                {% endif %}
              </p>
              <div class="absolute inset-0 pointer-events-none opacity-[0.07] bg-[radial-gradient(circle_at_50%_50%,#6366f1,transparent_70%)]"></div>
            </div>
          </section>
          
          <!-- Key Metrics Grid -->
          <section class="grid md:grid-cols-4 gap-4 mb-8">
            {% if results.enhanced_analysis.relevance.score is not none %}
            <div class="card-tw fade-in text-center">
              <h3 class="font-semibold text-sm mb-2 text-sky-700 dark:text-sky-300">Job Match</h3>
              <div class="text-3xl font-bold mb-1 text-sky-600 dark:text-sky-400">{{ "%.0f"|format(results.enhanced_analysis.relevance.score) }}%</div>
              <p class="text-xs text-slate-500 dark:text-slate-400">Relevance</p>
            </div>
            {% endif %}
            
            <div class="card-tw fade-in text-center">
              <h3 class="font-semibold text-sm mb-2 text-cyan-700 dark:text-cyan-300">Impact</h3>
              <div class="text-3xl font-bold mb-1 text-cyan-600 dark:text-cyan-400">{{ "%.0f"|format(results.enhanced_analysis.impact.score) }}%</div>
              <p class="text-xs text-slate-500 dark:text-slate-400">Achievement</p>
            </div>
            
            <div class="card-tw fade-in text-center">
              <h3 class="font-semibold text-sm mb-2 text-cyan-700 dark:text-cyan-300">Structure</h3>
              <div class="text-3xl font-bold mb-1 text-cyan-600 dark:text-cyan-400">{{ "%.0f"|format(results.enhanced_analysis.structure.score) }}%</div>
              <p class="text-xs text-slate-500 dark:text-slate-400">Organization</p>
            </div>
            
            <div class="card-tw fade-in text-center">
              <h3 class="font-semibold text-sm mb-2 text-sky-700 dark:text-sky-300">Clarity</h3>
              <div class="text-3xl font-bold mb-1 text-sky-600 dark:text-sky-400">{{ "%.0f"|format(results.enhanced_analysis.clarity.score) }}%</div>
              <p class="text-xs text-slate-500 dark:text-slate-400">Readability</p>
            </div>
          </section>
          
          <!-- Top Recommendations -->
          {% if results.enhanced_analysis.gaps.improvement_suggestions %}
          <section class="mb-8">
            <div class="card-tw fade-in">
              <h3 class="text-lg font-bold text-slate-800 dark:text-slate-100 mb-4">Priority Improvements</h3>
              <ul class="space-y-3 mb-6">
                {% for suggestion in results.enhanced_analysis.gaps.improvement_suggestions[:3] %}
                <li class="flex items-start gap-3 text-sm text-slate-700 dark:text-slate-300">
                  <span class="flex-shrink-0 w-6 h-6 rounded-full bg-sky-100 dark:bg-sky-900/40 flex items-center justify-center text-sky-600 dark:text-sky-300 text-xs font-semibold">{{ loop.index }}</span>
                  <span class="flex-1">{{ suggestion }}</span>
                </li>
                {% endfor %}
              </ul>
              
              <div class="text-center border-t border-slate-200 dark:border-slate-700 mb-1">
                <button id="showDetailedBtn" class="btn-outline-tw hover:bg-slate-100 dark:hover:bg-slate-800">
                  View Detailed Analysis ‚Üí
                </button>
              </div>
            </div>
          </section>
          {% endif %}
        {% else %}
          <div class="max-w-2xl mx-auto">
            <div class="card-tw fade-in text-center">
              <svg class="w-16 h-16 mx-auto mb-4 text-slate-400 dark:text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              <p class="text-slate-600 dark:text-slate-400">Enhanced scoring not available. Please analyze a resume with a job description for complete metrics.</p>
            </div>
          </div>
        {% endif %}
      </div>
      
      <!-- DETAILED VIEW (Shown by default) -->
      <div id="detailedView">
      <!-- Top Summary Cards -->
      <section class="grid md:grid-cols-3 gap-8 mb-10">
        <!-- Candidate Info -->
        <div class="card-tw fade-in flex flex-col justify-between">
          <div>
            <h2 class="font-semibold text-lg mb-4 flex items-center gap-2"><span class="w-6 h-6 rounded-full bg-sky-100 dark:bg-sky-900/40 flex items-center justify-center text-sky-600 dark:text-sky-300 text-xs">A</span> Candidate</h2>
            <ul class="space-y-1 text-sm">
              <li><span class="text-slate-500 dark:text-slate-400">Name:</span> {{ results.name or 'N/A' }}</li>
              <li><span class="text-slate-500 dark:text-slate-400">Email:</span> {{ results.email or 'N/A' }}</li>
              <li><span class="text-slate-500 dark:text-slate-400">Phone:</span> {{ results.phone or 'N/A' }}</li>
            </ul>
          </div>
          <p class="mt-4 text-[11px] leading-relaxed text-slate-500 dark:text-slate-500">Improve clarity with concise bullets, action verbs & quantified outcomes. Tailor key tech stacks to the role.</p>
        </div>

        <!-- Semantic Match -->
        <div class="card-tw fade-in flex flex-col items-center justify-center text-center relative overflow-hidden">
          <h2 class="font-semibold text-sm uppercase tracking-wide text-slate-500 dark:text-slate-400 mb-4">Semantic Match</h2>
          <div class="metric-ring mb-3" style="--pct: {{ sim_pct }}%"><span>{{ results.similarity_score }}</span></div>
          <p class="text-xs text-slate-500 dark:text-slate-400 max-w-[14ch]">Alignment with job description content.</p>
          <div class="absolute inset-0 pointer-events-none opacity-[0.07] bg-[radial-gradient(circle_at_70%_30%,#6366f1,transparent_60%)]"></div>
        </div>

        <!-- Quality Score -->
        <div class="card-tw fade-in flex flex-col items-center justify-center text-center relative overflow-hidden">
          <h2 class="font-semibold text-sm uppercase tracking-wide text-slate-500 dark:text-slate-400 mb-4">Resume Quality</h2>
            <div class="metric-ring mb-3" style="--pct: {{ qual_pct }}%"><span>{{ qual_pct }}%</span></div>
            <p class="text-xs text-slate-500 dark:text-slate-400 max-w-[16ch]">Action verbs ‚Ä¢ Impact ‚Ä¢ Conciseness.</p>
            <div class="absolute inset-0 pointer-events-none opacity-[0.07] bg-[radial-gradient(circle_at_30%_70%,#6366f1,transparent_60%)]"></div>
        </div>
      </section>

      <!-- Enhanced Multi-Metric Analysis -->
      {% if results.has_enhanced_data and results.enhanced_analysis %}
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6 text-slate-800 dark:text-slate-100">Detailed Analysis Breakdown</h2>
        
        <!-- Five Metric Cards -->
        <div class="grid md:grid-cols-5 gap-4 mb-8">
          <!-- Relevance -->
          {% if results.enhanced_analysis.relevance.score is not none %}
          <div class="card-tw fade-in text-center">
            <h3 class="font-semibold text-sm mb-2 text-blue-700 dark:text-blue-300">Relevance</h3>
            <div class="text-2xl font-bold mb-1 text-blue-600 dark:text-blue-400">{{ "%.0f"|format(results.enhanced_analysis.relevance.score) }}%</div>
            <p class="text-xs text-slate-500 dark:text-slate-400">Job Match</p>
          </div>
          {% endif %}
          
          <!-- Impact -->
          <div class="card-tw fade-in text-center">
            <h3 class="font-semibold text-sm mb-2 text-green-700 dark:text-green-300">Impact</h3>
            <div class="text-2xl font-bold mb-1 text-green-600 dark:text-green-400">{{ "%.0f"|format(results.enhanced_analysis.impact.score) }}%</div>
            <p class="text-xs text-slate-500 dark:text-slate-400">Achievement</p>
          </div>
          
          <!-- Structure -->
          <div class="card-tw fade-in text-center">
            <h3 class="font-semibold text-sm mb-2 text-purple-700 dark:text-purple-300">Structure</h3>
            <div class="text-2xl font-bold mb-1 text-purple-600 dark:text-purple-400">{{ "%.0f"|format(results.enhanced_analysis.structure.score) }}%</div>
            <p class="text-xs text-slate-500 dark:text-slate-400">Organization</p>
          </div>
          
          <!-- Clarity -->
          <div class="card-tw fade-in text-center">
            <h3 class="font-semibold text-sm mb-2 text-orange-700 dark:text-orange-300">Clarity</h3>
            <div class="text-2xl font-bold mb-1 text-orange-600 dark:text-orange-400">{{ "%.0f"|format(results.enhanced_analysis.clarity.score) }}%</div>
            <p class="text-xs text-slate-500 dark:text-slate-400">Readability</p>
          </div>
          
          <!-- Completion -->
          <div class="card-tw fade-in text-center">
            <h3 class="font-semibold text-sm mb-2 text-red-700 dark:text-red-300">Completion</h3>
            <div class="text-2xl font-bold mb-1 text-red-600 dark:text-red-400">{{ "%.0f"|format(results.enhanced_analysis.gaps.score) }}%</div>
            <p class="text-xs text-slate-500 dark:text-slate-400">Coverage</p>
          </div>
        </div>

        <!-- Detailed Breakdowns -->
        <div class="grid md:grid-cols-2 gap-8">
          <!-- Impact Details -->
          <div class="card-tw fade-in">
            <h3 class="font-semibold text-lg mb-4 text-green-700 dark:text-green-300">Impact Analysis</h3>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-sm text-slate-600 dark:text-slate-400">Quantified Achievements</span>
                <span class="font-semibold">{{ "%.0f"|format(results.enhanced_analysis.impact.components.quantified_achievements * 100) }}%</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-slate-600 dark:text-slate-400">Leadership Indicators</span>
                <span class="font-semibold">{{ "%.0f"|format(results.enhanced_analysis.impact.components.leadership_indicators * 100) }}%</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-slate-600 dark:text-slate-400">Action Verb Strength</span>
                <span class="font-semibold">{{ "%.0f"|format(results.enhanced_analysis.impact.components.action_verb_strength * 100) }}%</span>
              </div>
              <div class="text-xs text-slate-500 dark:text-slate-500 mt-3">
                Found {{ results.enhanced_analysis.impact.details.quantifiable_count }} quantifiable achievements
              </div>
            </div>
          </div>

          <!-- Structure Details -->
          <div class="card-tw fade-in">
            <h3 class="font-semibold text-lg mb-4 text-purple-700 dark:text-purple-300">Structure Analysis</h3>
            <div class="space-y-3">
              <div class="flex justify-between items-center">
                <span class="text-sm text-slate-600 dark:text-slate-400">Section Organization</span>
                <span class="font-semibold">{{ "%.0f"|format(results.enhanced_analysis.structure.components.section_organization * 100) }}%</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-slate-600 dark:text-slate-400">Contact Info</span>
                <span class="font-semibold">{{ "%.0f"|format(results.enhanced_analysis.structure.components.contact_completeness * 100) }}%</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-slate-600 dark:text-slate-400">Length Appropriateness</span>
                <span class="font-semibold">{{ "%.0f"|format(results.enhanced_analysis.structure.components.length_appropriateness * 100) }}%</span>
              </div>
              <div class="text-xs text-slate-500 dark:text-slate-500 mt-3">
                {{ results.enhanced_analysis.structure.details.word_count }} words, {{ results.enhanced_analysis.structure.details.sections_found }} sections
              </div>
            </div>
          </div>
        </div>

        <!-- Gaps and Recommendations -->
        {% if results.enhanced_analysis.gaps.improvement_suggestions %}
        <div class="card-tw fade-in mt-8">
          <h3 class="font-semibold text-lg mb-4 text-red-700 dark:text-red-300">Improvement Opportunities</h3>
          <ul class="space-y-2">
            {% for suggestion in results.enhanced_analysis.gaps.improvement_suggestions %}
            <li class="flex items-start gap-2">
              <span class="text-red-500 dark:text-red-400 mt-1">‚Ä¢</span>
              <span class="text-sm text-slate-700 dark:text-slate-300">{{ suggestion }}</span>
            </li>
            {% endfor %}
          </ul>
          
          {% if results.enhanced_analysis.gaps.critical_missing %}
          <div class="mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
            <h4 class="font-semibold text-sm text-red-700 dark:text-red-300 mb-2">Critical Missing Skills</h4>
            <div class="flex flex-wrap gap-2">
              {% for skill in results.enhanced_analysis.gaps.critical_missing %}
              <span class="text-xs bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 px-2 py-1 rounded">{{ skill }}</span>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
        {% endif %}
      </section>
      {% endif %}

      <!-- Keywords & Skills (Only in Full Analysis Mode) -->
      {% if not results.is_quality_mode %}
      <section class="grid md:grid-cols-2 gap-8 mb-12">
        <!-- Matched Skills -->
        <div class="card-tw fade-in">
          <h3 class="font-semibold text-lg mb-4 flex items-center gap-2"><span class="w-6 h-6 rounded-full bg-sky-100 dark:bg-sky-900/40 flex items-center justify-center text-sky-600 dark:text-sky-300 text-xs">B</span> Matched Keywords</h3>
          {% if results.matched_keywords %}
            <div class="flex flex-wrap">
              {% for skill in results.matched_keywords %}
                <span class="badge-skill">{{ skill }}</span>
              {% endfor %}
            </div>
          {% else %}
            <p class="text-xs text-slate-500 dark:text-slate-500">No overlapping keywords found.</p>
          {% endif %}
        </div>
        <!-- Missing Skills -->
        <div class="card-tw fade-in">
          <h3 class="font-semibold text-lg mb-4 flex items-center gap-2"><span class="w-6 h-6 rounded-full bg-sky-100 dark:bg-sky-900/40 flex items-center justify-center text-sky-600 dark:text-sky-300 text-xs">C</span> Suggested Additions</h3>
          {% if results.missing_keywords %}
            <p class="text-xs mb-3 text-slate-500 dark:text-slate-500">Consider incorporating these relevant terms naturally:</p>
            <div class="flex flex-wrap">
              {% for skill in results.missing_keywords %}
                <span class="badge-skill badge-missing">{{ skill }}</span>
              {% endfor %}
            </div>
          {% else %}
            <p class="text-xs text-green-600 dark:text-green-400 font-medium">Great coverage ‚Äî no critical gaps üéâ</p>
          {% endif %}
        </div>
      </section>
      {% endif %}

      <!-- Action Verb Analysis -->
      {% if results.action_verb_analysis %}
      <section class="card-tw fade-in mb-12">
        <h3 class="font-semibold text-lg mb-4 flex items-center gap-2"><span class="w-6 h-6 rounded-full bg-sky-100 dark:bg-sky-900/40 flex items-center justify-center text-sky-600 dark:text-sky-300 text-xs">D</span> Action Verb Analysis</h3>
        
        <!-- Verb Tier Summary -->
        <div class="grid md:grid-cols-3 gap-4 mb-6">
          <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs font-medium text-red-700 dark:text-red-300 uppercase tracking-wide">Impact Verbs</span>
              <span class="text-lg font-bold text-red-600 dark:text-red-400">{{ results.action_verb_analysis.tier_counts.impact }}</span>
            </div>
            <p class="text-xs text-red-600 dark:text-red-400">Leadership & Innovation (3x weight)</p>
            {% if results.action_verb_analysis.impact_verbs %}
              <div class="mt-2 flex flex-wrap gap-1">
                {% for verb in results.action_verb_analysis.impact_verbs[:5] %}
                  <span class="text-xs bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 px-2 py-1 rounded">{{ verb }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs font-medium text-blue-700 dark:text-blue-300 uppercase tracking-wide">Build Verbs</span>
              <span class="text-lg font-bold text-blue-600 dark:text-blue-400">{{ results.action_verb_analysis.tier_counts.build }}</span>
            </div>
            <p class="text-xs text-blue-600 dark:text-blue-400">Creation & Implementation (2x weight)</p>
            {% if results.action_verb_analysis.build_verbs %}
              <div class="mt-2 flex flex-wrap gap-1">
                {% for verb in results.action_verb_analysis.build_verbs[:5] %}
                  <span class="text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-1 rounded">{{ verb }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="bg-gray-50 dark:bg-gray-900/20 border border-gray-200 dark:border-gray-800 rounded-lg p-3">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wide">Support Verbs</span>
              <span class="text-lg font-bold text-gray-600 dark:text-gray-400">{{ results.action_verb_analysis.tier_counts.support }}</span>
            </div>
            <p class="text-xs text-gray-600 dark:text-gray-400">Collaboration & Support (1x weight)</p>
            {% if results.action_verb_analysis.support_verbs %}
              <div class="mt-2 flex flex-wrap gap-1">
                {% for verb in results.action_verb_analysis.support_verbs[:5] %}
                  <span class="text-xs bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-300 px-2 py-1 rounded">{{ verb }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Score Summary -->
        <div class="bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800 rounded-lg p-4">
          <div class="flex items-center justify-between">
            <div>
              <h4 class="font-semibold text-indigo-900 dark:text-indigo-100">Weighted Action Verb Score</h4>
              <p class="text-sm text-indigo-700 dark:text-indigo-300">{{ results.action_verb_analysis.total_verbs }} verbs total ‚Ä¢ {{ results.action_verb_analysis.weighted_score }} weighted points</p>
            </div>
            <div class="text-right">
              <div class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">{{ "%.1f"|format(results.action_verb_analysis.weighted_score) }}</div>
              <div class="text-xs text-indigo-500 dark:text-indigo-400">Total Score</div>
            </div>
          </div>
        </div>
      </section>
      {% endif %}

      <!-- Dynamic Recommendations Section -->
      <section class="card-tw fade-in mb-14">
              <!-- Personalized Recommendations -->
      <section class="card-tw fade-in mb-12">
        <h3 class="font-semibold text-lg mb-4 flex items-center gap-2"><span class="w-6 h-6 rounded-full bg-sky-100 dark:bg-sky-900/40 flex items-center justify-center text-sky-600 dark:text-sky-300 text-xs">E</span> Personalized Recommendations</h3>
        
        {% if results.has_enhanced_data and results.enhanced_analysis %}
        <!-- Dynamic recommendations based on scores -->
        <div class="space-y-3">
          <!-- Impact-based recommendations -->
          {% if results.enhanced_analysis.impact.score < 70 %}
          <div class="p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg">
            <h4 class="font-semibold text-sm text-amber-800 dark:text-amber-200 mb-2">üéØ Boost Impact</h4>
            <ul class="text-sm space-y-1 text-amber-700 dark:text-amber-300">
              {% if results.enhanced_analysis.impact.components.quantified_achievements < 0.5 %}
              <li>‚Ä¢ Add numbers to your achievements: percentages, dollar amounts, team sizes, or timeframes</li>
              {% endif %}
              {% if results.enhanced_analysis.impact.components.action_verb_strength < 0.6 %}
              <li>‚Ä¢ Replace weak verbs like "helped" or "worked on" with stronger action verbs like "delivered" or "led"</li>
              {% endif %}
              {% if results.enhanced_analysis.impact.components.leadership_indicators < 0.4 %}
              <li>‚Ä¢ Highlight leadership experiences: mention team size, mentoring, or project ownership</li>
              {% endif %}
            </ul>
          </div>
          {% endif %}

          <!-- Structure-based recommendations -->
          {% if results.enhanced_analysis.structure.score < 80 %}
          <div class="p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
            <h4 class="font-semibold text-sm text-blue-800 dark:text-blue-200 mb-2">üìã Improve Structure</h4>
            <ul class="text-sm space-y-1 text-blue-700 dark:text-blue-300">
              {% if not results.enhanced_analysis.structure.details.has_email %}
              <li>‚Ä¢ Add a professional email address to your contact information</li>
              {% endif %}
              {% if not results.enhanced_analysis.structure.details.has_phone %}
              <li>‚Ä¢ Include a phone number for direct contact</li>
              {% endif %}
              {% if results.enhanced_analysis.structure.details.sections_found < 4 %}
              <li>‚Ä¢ Add clear section headers: Experience, Education, Skills, Projects</li>
              {% endif %}
              {% if results.enhanced_analysis.structure.details.word_count < 300 %}
              <li>‚Ä¢ Expand your content - aim for 400-800 words for optimal length</li>
              {% elif results.enhanced_analysis.structure.details.word_count > 1000 %}
              <li>‚Ä¢ Consider condensing content - aim for 400-800 words for better readability</li>
              {% endif %}
            </ul>
          </div>
          {% endif %}

          <!-- Clarity-based recommendations -->
          {% if results.enhanced_analysis.clarity.score < 75 %}
          <div class="p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg">
            <h4 class="font-semibold text-sm text-green-800 dark:text-green-200 mb-2">‚ú® Enhance Clarity</h4>
            <ul class="text-sm space-y-1 text-green-700 dark:text-green-300">
              {% if results.enhanced_analysis.clarity.details.avg_words_per_sentence > 20 %}
              <li>‚Ä¢ Shorten your bullet points - aim for 15-18 words per sentence for better readability</li>
              {% endif %}
              {% if results.enhanced_analysis.clarity.components.technical_precision < 0.5 %}
              <li>‚Ä¢ Add more specific technical terms relevant to your field</li>
              {% endif %}
              <li>‚Ä¢ Use bullet points consistently to improve scanability</li>
            </ul>
          </div>
          {% endif %}

          <!-- Relevance-based recommendations -->
          {% if results.enhanced_analysis.relevance.score is not none and results.enhanced_analysis.relevance.score < 70 %}
          <div class="p-3 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg">
            <h4 class="font-semibold text-sm text-purple-800 dark:text-purple-200 mb-2">üéØ Improve Job Alignment</h4>
            <ul class="text-sm space-y-1 text-purple-700 dark:text-purple-300">
              {% if results.enhanced_analysis.relevance.components.keyword_match_rate < 0.6 %}
              <li>‚Ä¢ Incorporate more keywords from the job description naturally into your experience</li>
              {% endif %}
              {% if results.enhanced_analysis.relevance.components.semantic_similarity < 0.7 %}
              <li>‚Ä¢ Tailor your language to match the job description's terminology and focus areas</li>
              {% endif %}
            </ul>
          </div>
          {% endif %}

          <!-- High-level success message -->
          {% if results.enhanced_analysis.overall_score >= 85 %}
          <div class="p-4 bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700 rounded-lg">
            <h4 class="font-semibold text-green-800 dark:text-green-200 mb-2">üéâ Excellent Resume!</h4>
            <p class="text-sm text-green-700 dark:text-green-300">Your resume shows strong performance across all metrics. Consider these minor optimizations to reach perfection.</p>
          </div>
          {% endif %}
        </div>
        {% else %}
        <!-- Fallback static recommendations -->
        <ul class="text-sm space-y-2 list-disc pl-5 marker:text-indigo-500 dark:marker:text-indigo-400">
          <li>Add strong past-tense action verbs at the start of experience bullets if missing.</li>
          <li>Quantify impact (%, $, time saved, scale) in at least 30‚Äì40% of bullets.</li>
          <li>Group tools & tech logically; avoid raw comma dumps.</li>
          <li>Tailor top 3‚Äì5 achievements to mirror role responsibilities.</li>
        </ul>
        {% endif %}
      </section>
      </div> <!-- End of detailedView -->
    {% else %}
      <p class="text-slate-600 dark:text-slate-400">No results to display.</p>
    {% endif %}

    <footer class="mt-12 pt-8 border-t border-slate-200 dark:border-slate-700 text-xs text-slate-500 dark:text-slate-500 flex flex-col md:flex-row gap-2 md:items-center md:justify-between">
      <p>¬© {{ 2025 }} Resume Analyzer | <a href="/skills" class="text-sky-500 hover:text-sky-600 dark:text-sky-400 dark:hover:text-sky-300 transition-colors">Skills Database</a></p>
      <p>Semantic + structural metrics preview.</p>
    </footer>
  </div>

  <script>
    // Theme toggle
    const root = document.documentElement; 
    const themeBtn = document.getElementById('themeToggle');
    (function(){ 
      const saved = localStorage.getItem('theme'); 
      if(saved==='dark'){ 
        root.classList.add('dark'); 
      } 
    })();
    if(themeBtn){ 
      themeBtn.addEventListener('click',()=>{ 
        const d = root.classList.toggle('dark'); 
        localStorage.setItem('theme', d? 'dark':'light'); 
      }); 
    }

    // View toggle between simple and detailed
    const viewToggleBtn = document.getElementById('viewToggle');
    const viewToggleText = document.getElementById('viewToggleText');
    const viewToggleIcon = document.getElementById('viewToggleIcon');
    const simpleView = document.getElementById('simpleView');
    const detailedView = document.getElementById('detailedView');
    const showDetailedBtn = document.getElementById('showDetailedBtn');
    
    // Load saved view preference
    const savedView = localStorage.getItem('analysisView') || 'detailed';
    
    function switchToView(view) {
      if (view === 'simple') {
        simpleView.classList.remove('hidden');
        detailedView.classList.add('hidden');
        viewToggleText.textContent = 'Detailed View';
        // Change icon to grid for detailed view
        viewToggleIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>';
        localStorage.setItem('analysisView', 'simple');
      } else {
        simpleView.classList.add('hidden');
        detailedView.classList.remove('hidden');
        viewToggleText.textContent = 'Simple View';
        // Change icon to single chart for simple view
        viewToggleIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>';
        localStorage.setItem('analysisView', 'detailed');
      }
    }
    
    // Initialize with saved preference
    switchToView(savedView);
    
    // Toggle button handler
    if (viewToggleBtn) {
      viewToggleBtn.addEventListener('click', () => {
        const currentView = localStorage.getItem('analysisView') || 'detailed';
        switchToView(currentView === 'simple' ? 'detailed' : 'simple');
      });
    }
    
    // Show detailed button handler (from simple view)
    if (showDetailedBtn) {
      showDetailedBtn.addEventListener('click', () => {
        switchToView('detailed');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }
  </script>
</body>
</html>
